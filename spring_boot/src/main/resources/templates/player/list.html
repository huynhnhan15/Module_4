<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách cầu thủ (API)</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
<h1 class="mb-4">Danh sách cầu thủ</h1>

<form id="searchForm" class="d-flex mb-3">
    <input id="searchInput" class="form-control me-2" placeholder="Nhập tên cầu thủ...">
    <button class="btn btn-primary" type="submit">Tìm kiếm</button>
</form>

<a href="/players/add" class="btn btn-success mb-3">+ Thêm cầu thủ (trang cũ)</a>

<div id="message" class="alert alert-success d-none"></div>

<!-- Bảng hiển thị -->
<table class="table table-bordered table-striped">
    <thead class="table-dark">
    <tr>
        <th>STT</th>
        <th>ID</th>
        <th>Họ và tên</th>
        <th>Ngày sinh</th>
        <th>Kinh nghiệm</th>
        <th>Vị trí</th>
        <th>Ảnh đại diện</th>
        <th>Hành động</th>
    </tr>
    </thead>
    <tbody id="playerTableBody">
    </tbody>
</table>

<script>
    const API_BASE = '/api/players';
    const tableBody = document.getElementById('playerTableBody');
    const messageBox = document.getElementById('message');
    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');


    async function loadPlayers(query = '') {
        let url = API_BASE;
        if (query.trim() !== '') {
            url += `/search?q=${encodeURIComponent(query)}`;
        }
        const res = await fetch(url);
        const players = await res.json();
        renderTable(players);
    }

    function renderTable(players) {
        tableBody.innerHTML = '';
        players.forEach((p, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${p.id}</td>
                    <td>${p.name}</td>
                    <td>${p.birthday || ''}</td>
                    <td>${p.experience || ''}</td>
                    <td>${p.position || ''}</td>
                    <td>
                        <img src="${p.avatar || ''}" alt="avatar" width="80" height="80"/>
                    </td>
                    <td>
                        <a href="/players/detail/${p.id}" class="btn btn-primary btn-sm">Xem chi tiết</a>
                        <button class="btn btn-danger btn-sm" onclick="deletePlayer(${p.id})">Xóa</button>
                    </td>
                `;
            tableBody.appendChild(tr);
        });
    }



    searchForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loadPlayers(searchInput.value);
    });

    function showMessage(text) {
        messageBox.textContent = text;
        messageBox.classList.remove('d-none');
        setTimeout(() => messageBox.classList.add('d-none'), 3000);
    }

    loadPlayers();
</script>
</body>
</html>
